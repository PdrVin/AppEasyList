<!DOCTYPE html>
<html lang="br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Fácil</title>
    <link rel="stylesheet" href="/styles/listar.css">

</head>

<body>
    <main class="container">
        <h1>Lista Fácil</h1>
        <div class="form">
            <label>Item</label>
            <input type="text" id="item" placeholder="Digite um item">
            <label>Valor</label>
            <input type="number" id="valor" min="0.01" step="any" placeholder="Insira o valor">
            <button id="addBtn">Adicionar Item</button>
        </div>
        <ul id="itemList">

        </ul>
        <div>
            <span>Total:</span>
            <span id="totalValue">R$ 0.00</span>
        <button id="checkoutBtn" onclick="redirectToCheckout()">Agendar Produtos</button>
        </div>
    </main>

    <script>
        document.getElementById("addBtn").addEventListener("click", addItem);

        function addItem() {
            var newItem = document.getElementById("item").value;
            var newValue = parseFloat(document.getElementById("valor").value);

            if (newItem !== "" && !isNaN(newValue)) {
                var itemList = document.getElementById("itemList");
                var li = document.createElement("li");
                
                var itemName = document.createElement("span");
                itemName.className = "item-name";
                itemName.textContent = newItem;
                li.appendChild(itemName);
                
                var itemValue = document.createElement("span");
                itemValue.className = "item-value";
                itemValue.textContent = "R$ " + newValue.toFixed(2);
                li.appendChild(itemValue);

                var removeBtn = document.createElement("button");
                removeBtn.textContent = "Remover";
                removeBtn.className = "removeBtn";
                removeBtn.addEventListener("click", function () {
                    removeItem(li, newValue);
                });
                li.appendChild(removeBtn);

                itemList.appendChild(li);
                updateTotalValue(newValue);

                saveItems();
                document.getElementById("item").value = "";
                document.getElementById("valor").value = "";
            } else {
                alert("Por favor, digite um item e um valor numérico.");
            }
        }

        function removeItem(item, value) {
            item.parentNode.removeChild(item);
            updateTotalValue(-value);
            saveItems();
        }

        function updateTotalValue(value) {
            var totalValueSpan = document.getElementById("totalValue");
            var currentValue = parseFloat(totalValueSpan.textContent.slice(2));
            var updatedValue = currentValue + value;
            totalValueSpan.textContent = "R$ " + updatedValue.toFixed(2);
        }

        function saveItems() {
            var itemList = document.getElementById("itemList").innerHTML;
            localStorage.setItem("shoppingList", itemList);
        }

        window.onload = function () {
            var storedItems = localStorage.getItem("shoppingList");
            if (storedItems) {
                document.getElementById("itemList").innerHTML = storedItems;
            }

            var removeButtons = document.getElementsByClassName("removeBtn");
            for (var i = 0; i < removeButtons.length; i++) {
                var valueSpan = removeButtons[i].previousElementSibling;
                var value = parseFloat(valueSpan.textContent.slice(2));
                removeButtons[i].addEventListener("click", function () {
                    removeItem(this.parentNode, value);
                });
                updateTotalValue(value);
            }
        };

        function redirectToCheckout() {
            window.location.href = "/pages/carrinho.html";
        }
    </script>

    <!-- Rodapé -->
    <footer>
        <p>Lista Fácil &copy; 2024 - Todos os direitos reservados.<br>
        Entre em contato: contato@listafacil.com</p>
        <a href="/index.html">Voltar ao início</a>
    </footer>
</body>

</html>